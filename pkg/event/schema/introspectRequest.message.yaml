##
# Message schema for introspectRepository
#
# http://json-schema.org
# http://json-schema.org/latest/json-schema-core.html
# http://json-schema.org/latest/json-schema-validation.html
##
$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://github.com/content-services/content-sources-backend/schema/introspectRepository.message.yaml"
title: Introspect Repository
description: Schema for the introspect repository kafka message
type: object
properties:
  x-rh-identity:
    description: The x-rh-identity coded in base64
    type: string
    # https://regex101.com/r/cP6rU8/1
    # pattern: |
    #   /^[A-Z0-9\+\/]*=?$/i
  x-rh-insights-request-id:
    description: The request id for distributed tracing
    type: string
    # TODO Search for the request-id format
    # pattern:
  url:
    description: The base url for the repository to be introspected
    type: string
    # https://regex101.com/r/kE6aO8/1
    # pattern: |
    #   /^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i
  state:
    description: The state for the current message
    type: string
    # pattern: ^(Request)$
required:
- x-rh-identity
- x-rh-insights-request-id
- url
- state
